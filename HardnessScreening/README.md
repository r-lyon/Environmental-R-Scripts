# Hardness-Dependent Metal Screening Tool

**Author:** R. Lyon  
**Date:** 2024-11-11  

---

## Overview
This R script screens surface water samples for hardness-dependent metals against both **acute** and **chronic aquatic life criteria** using New Mexico Environment Department (NMED) surface water quality standards (20.6.4.900 NMAC).  https://www.env.nm.gov/surface-water-quality/wp-content/uploads/sites/18/2025/04/20.006.0004-NMAC-22May25.pdf

The criteria are expressed as a function of **hardness (mg CaCO₃/L)** and apply within specific hardness ranges:  

- **0–400 mg/L** for most metals (criteria for 400 mg/L applied above range)  
- **0–220 mg/L** for Aluminum (criteria for 220 mg/L applied above range)  

Acute and chronic criteria (in µg/L) are calculated using:  

Acute: exp(mA * ln(hardness) + bA) * CF
Chronic: exp(mC * ln(hardness) + bC) * CF

Where:  
- `mA` / `bA` and `mC` / `bC` are metal-specific constants  
- `CF` is the conversion factor  
- Special adjustments are applied for Cadmium and Lead  
- Aluminum is treated separately based on if sample is from base flow (WS) or storm flow (WT)
- **Note:** The script excludes the 2025 site-specific copper criteria for the Pajarito Plateau (Rio Grande Basin).  

---

## Data Source
Surface water chemistry and hardness data were obtained from Intellus New Mexico (https://www.intellusnm.com/), which provides public access to environmental monitoring data for Los Alamos National Laboratory.  

---

## Folder Structure

HardnessScreening/
├─ code/
│ └─ HardnessDependentMetalScreening.R # Main R script
├─ data/
│ ├─ StreamGages_Sandia_N3B_Metals_Gen_Chem.csv # Intellus downloaded data
│ └─ acute_chronic_hard_dep_calc.xlsx # Acute and chronic metal specific constants and conversion factors
├─ img/
│ ├─ IntellusDownloadOptions.png #Intellus data download options
└─ output/
└─ metal_hardness_screen.xlsx # Example output generated by the script

---

## Usage

1. Open `HardnessDependentMetalScreening.R` in R or RStudio.  
2. Make sure the `gage_data_path` and `criteria_path` point to the correct files in the `Data/` folder.  
3. Run the script.  
4. The output Excel file with hardness-adjusted criteria and exceedance flags will be saved in the `Output/` folder.  

---

## Output
The output is an Excel file containing:  

- Site-specific hardness-adjusted metal criteria (acute and chronic)  
- Exceedance flags:  
  - `acute_exceedance` (1 = exceeds acute criteria)  
  - `chronic_exceedance` (1 = exceeds chronic criteria)  
  - `exceeds` (1 = exceeds either acute or chronic criteria)  

---

## Dependencies
The script uses the following R packages:

- `readr` – reading CSV files  
- `readxl` – reading Excel files  
- `writexl` – writing Excel outputs  
- `lubridate` – handling dates  
- `dplyr` – data manipulation  
- `janitor` – cleaning column names  

---

## Notes
- Ensure all hardness and metal names match exactly between your dataset and the criteria table.  
- Missing or zero hardness values may produce `NA` or errors in calculations.  
- Cadmium and Lead have special multipliers applied in the calculations.  
- Aluminum criteria are capped at 220 mg/L, other metals capped at 400 mg/L.  